@model System.Data.DataTable


@{
    // Yekun dəyərləri hesabla
    decimal totalBalance = 0;


    foreach (System.Data.DataRow row in Model.Rows)
    {
        totalBalance += Convert.ToDecimal(row["Initial_Balance"]);
    }
}

@{
    var balances = new List<decimal>();
    var names = new List<string>();

    foreach (System.Data.DataRow row in Model.Rows)
    {
        balances.Add(Convert.ToDecimal(row["Initial_Balance"]));
        names.Add(row["name"].ToString());
    }
}

<script>
    const names = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(names));
    const balances = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(balances));
    const totalBalance = @totalBalance; // totalBalance JS-də də mövcud oldu
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<div style="text-align: right; margin: 15px;">
    <button class="btn btn-danger" onclick="exportDashboardPDF()">PDF-ə Çıxart</button>
    <button class="btn btn-success" onclick="exportDashboardExcel()">Excel-ə Çıxart</button>
</div>


<script>
        async function exportDashboardPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'pt', 'a4');

        // Bütün charts-ları saxlayan container
        const dashboard = document.querySelector('body'); // ya da .Main-Container
        const canvas = await html2canvas(dashboard, { scale: 2 });
        const imgData = canvas.toDataURL('image/png');

        const pdfWidth = doc.internal.pageSize.getWidth();
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

        doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        doc.save("Dashboard.pdf");
    }

</script>

<script>
    function exportDashboardExcel() {
        var wb = XLSX.utils.book_new();

        var data = [["Name", "Initial Balance"]];

        for (let i = 0; i < names.length; i++) {
            data.push([names[i], balances[i]]);
        }

        // Yekun balansı əlavə et
        data.push(["Yekun", totalBalance]);

        var ws = XLSX.utils.aoa_to_sheet(data);
        XLSX.utils.book_append_sheet(wb, ws, "Dashboard");
        XLSX.writeFile(wb, "Dashboard.xlsx");
    }

</script>




<div class="balance-container">
    <h2>💰 Bank və Kassa Balansları</h2>

    <table class="custom-table">
        <thead>
            <tr>

                <th>Name</th>
                <th>Initial Balance</th>
            </tr>
        </thead>
        <tbody>
            @foreach (System.Data.DataRow row in Model.Rows)
            {
                <tr>
                    
                    <td>@row["name"]</td>
                    <td class="balance">@row["Initial_Balance"]</td>

                </tr>
            }
            <tr class="total-row">
                <td colspan="2"><strong>Yekun</strong></td>
                <td class="balance"><strong>@totalBalance</strong></td>
            </tr>
        </tbody>
    </table>
</div>

<style>
    .balance-container {
        max-width: 900px;
        margin: 30px auto;
        padding: 20px;
        background: #fdfdfd;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

        .balance-container h2 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
            color: #333;
            letter-spacing: 1px;
        }

    .custom-table {
        width: 100%;
        border-collapse: collapse;
        overflow: hidden;
        border-radius: 12px;
    }

        .custom-table thead {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: #fff;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .custom-table th, .custom-table td {
            padding: 14px 18px;
            text-align: center;
            border-bottom: 1px solid #eaeaea;
        }

        .custom-table tbody tr {
            transition: all 0.2s ease-in-out;
        }

            .custom-table tbody tr:hover {
                background: #f1f9ff;
                transform: scale(1.01);
            }

    /* Rənglər */
    .balance {
        color: #16a085;
        font-weight: bold;
    }

    .credit {
        color: #2980b9;
        font-weight: 500;
    }

    .debet {
        color: #c0392b;
        font-weight: 500;
    }

    /* Yekun sətir */
    .tot
